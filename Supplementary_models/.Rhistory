+ habitat
+ Method,
parameters = parameters,
chains = 3,
priors = prior,
convergence = 1.1,
ESS = 1000,
verbose = TRUE,
output = "mulTree_supp_models",
warn = FALSE,
ask = TRUE)
#Subset to just volant and terrestrial sepcies
cff_t <- cff_clean[cff_clean$habitat %in% c("volant",
"terrestrial"
),]
#reset the habitat factors to have just two levels of terrestrial and volant
cff_t$habitat <- factor(cff_t$habitat,
levels = c("terrestrial",
"volant"
))
#Put it in a Multree object.
cff_mul_terr <- as.mulTree(cff_t,
cff_tree,
taxa = "animal",
rand.terms = ~animal + Species_phylo,
clean.data = FALSE)
mulTree(mulTree.data = cff_mul_terr,
formula = CFF_log ~ log10(body_mass_us)*forage_light_level
+ mode_of_life
+ habitat
+ Method,
parameters = parameters,
chains = 3,
priors = prior,
convergence = 1.1,
ESS = 1000,
verbose = TRUE,
output = "cff_supp_terr_models",
warn = FALSE,
ask = TRUE)
Main_models <-   read.mulTree(mulTree.chain = "mulTree_supp_models",
convergence = FALSE,
model = FALSE)
Main_models_sp <-   read.mulTree(mulTree.chain = "mulTree_supp_models",
convergence = FALSE,
model = FALSE,
extract = c("VCV"))
print(summary(Main_models)[,c(1,2,5)],
digits = 2)
#Subset to just volant and terrestrial sepcies
cff_t <- cff_clean[cff_clean$habitat %in% c("volant",
"terrestrial"
),]
#reset the habitat factors to have just two levels of terrestrial and volant
cff_t$habitat <- factor(cff_t$habitat,
levels = c("terrestrial",
"volant"
))
#Put it in a Multree object.
cff_mul_terr <- as.mulTree(cff_t,
cff_tree,
taxa = "animal",
rand.terms = ~animal + Species_phylo,
clean.data = FALSE)
#Put it in a Multree object.
cff_mul_terr <- as.mulTree(cff_t,
cff_tree[1:5],
taxa = "animal",
rand.terms = ~animal + Species_phylo,
clean.data = FALSE)
#Put it in a Multree object.
cff_mul_terr <- as.mulTree(cff_t,
cff_tree[1:3],
taxa = "animal",
rand.terms = ~animal + Species_phylo,
clean.data = FALSE)
mulTree(mulTree.data = cff_mul_terr,
formula = CFF_log ~ log10(body_mass_us)*forage_light_level
+ mode_of_life
+ habitat
+ Method,
parameters = parameters,
chains = 3,
priors = prior,
convergence = 1.1,
ESS = 1000,
verbose = TRUE,
output = "cff_supp_terr_models",
warn = FALSE,
ask = TRUE)
mulTree(mulTree.data = cff_mul_terr,
formula = CFF_log ~ log10(body_mass)*forage_light_level
+ mode_of_life
+ habitat
+ Method,
parameters = parameters,
chains = 3,
priors = prior,
convergence = 1.1,
ESS = 1000,
verbose = TRUE,
output = "cff_supp_terr_models",
warn = FALSE,
ask = TRUE)
ter_models <-   read.mulTree(mulTree.chain = "cff_supp_terr_models",
convergence = FALSE,
model = FALSE,
extract = NULL)
print(summary(ter_models)[,c(1,2,5)], digits = 2)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_terr_sup_models-tree1_chain1",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_terr_sup_models-tree1_chain2",
convergence = FALSE,
model = T)
summary(terr_models_c1)
print(summary(ter_models)[,c(1,2,5)], digits = 2)
summary(ter_models)[,c(1,2,5)]
summary(ter_models)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_terr_sup_models-tree2_chain2",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_terr_sup_models-tree3_chain2",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_terr_sup_models-tree4_chain2",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_terr_sup_models-tree5_chain2",
convergence = FALSE,
model = T)
summary(terr_models_c1)
print(summary(terr_models_c1), digits = 2)
print(summary(terr_models_c1), digits = 1)
print(summary(terr_models_c1), digits = 3)
print(summary(terr_models_c1), digits = 2)
print(summary(terr_models_c1), digits = 1)
dev.new()
dev.new()
plot(cff_t[1])
plot(cff_tree[1])
dev.new()
dev.new()
dev.new()
plot(cff_tree[1], cex = 0.2)
cff_tree_fix <- cff_tree
for (i in 1:50){cff_tree_fix[i] <- cff_tree_fix[1]}
cff_tree_fix
#Put it in a Multree object.
cff_mul_terr <- as.mulTree(cff_t,
cff_tree_fix,
taxa = "animal",
rand.terms = ~animal + Species_phylo,
clean.data = FALSE)
mulTree(mulTree.data = cff_mul_terr,
formula = CFF_log ~ log10(body_mass)*forage_light_level
+ mode_of_life
+ habitat
+ Method,
parameters = parameters,
chains = 3,
priors = prior,
convergence = 1.1,
ESS = 1000,
verbose = TRUE,
output = "cff_supp_terr_models",
warn = FALSE,
ask = TRUE)
ter_models <-   read.mulTree(mulTree.chain = "cff_supp_terr_models",
convergence = FALSE,
model = FALSE,
extract = NULL)
ter_models_sp <-   read.mulTree(mulTree.chain = "cff_supp_terr_models",
convergence = FALSE,
model = FALSE,
extract = "VCV")
print(summary(ter_models)[,c(1,2,5)], digits = 2)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree1_chain1",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree51_chain1",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree52_chain1",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree53_chain1",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree54_chain1",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree55_chain1",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree56_chain1",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree57_chain1",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree57_chain2",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree57_chain3",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree58_chain3",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree59_chain3",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree60_chain3",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree61_chain3",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree62_chain3",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree63_chain3",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree64_chain3",
convergence = FALSE,
model = T)
summary(terr_models_c1)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree65_chain3",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree66_chain3",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree68_chain3",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree68_chain1",
convergence = FALSE,
model = T)
summary(terr_models_c1)
terr_models_c1 <-   read.mulTree(mulTree.chain = "cff_supp_terr_models-tree68_chain2",
convergence = FALSE,
model = T)
summary(terr_models_c1)
cff_clean <- cff_raw[,c("Species_phylo",
"Class",
"habitat",
"forage_light_level",
"body_mass",
"mode_of_life",
"Method",
"CFF",
"CFF_log")]
cff_clean <- data.frame(cff_clean, animal = cff_clean$Species_phylo)
cff_raw <- read.csv("Haarlem_et_al_cff_dataset_21_10_2025.csv",
header = T,
sep = ",")
#Create a varaible for log10(CFF)
cff_raw$CFF_log <- log10(cff_raw$CFF)
#Set sessile_food as the baseline
cff_raw$mode_of_life <- factor(cff_raw$mode_of_life,
levels = c("sessile_food",
"ballistic",
"pursuit"
))
#Set terrestrial as the baseline
cff_raw$habitat <- factor(cff_raw$habitat,
levels = c("terrestrial",
"nektonic",
"demersal",
"volant"
))
cff_clean <- cff_raw[,c("Species_phylo",
"Class",
"habitat",
"forage_light_level",
"body_mass",
"mode_of_life",
"Method",
"CFF",
"CFF_log")]
#Drop Melanophila_acuminata
cff_clean <- cff_clean[cff_clean$Species_phylo != "Melanophila_acuminata",]
cff_clean <- data.frame(cff_clean, animal = cff_clean$Species_phylo)
cff_clean <- cff_raw[,c("Species_phylo",
"Class",
"habitat",
"forage_light_level",
"body_mass",
"mode_of_life",
"Method",
"CFF",
"CFF_log")]
cff_clean <- data.frame(cff_clean, animal = cff_clean$Species_phylo)
cff_tree <- read.tree("cff_tree_test2.tree")
#Subset to just volant and terrestrial sepcies
cff_t <- cff_clean[cff_clean$habitat %in% c("volant",
"terrestrial"
),]
#reset the habitat factors to have just two levels of terrestrial and volant
cff_t$habitat <- factor(cff_t$habitat,
levels = c("terrestrial",
"volant"
))
#Put it in a Multree object.
cff_mul_terr <- as.mulTree(cff_t,
cff_tree,
taxa = "animal",
rand.terms = ~animal + Species_phylo,
clean.data = FALSE)
mulTree(mulTree.data = cff_mul_terr,
formula = CFF_log ~ log10(body_mass)*forage_light_level
+ mode_of_life
+ habitat
+ Method,
parameters = parameters,
chains = 3,
priors = prior,
convergence = 1.1,
ESS = 1000,
verbose = TRUE,
output = "cff_supp_terr_models",
warn = FALSE,
ask = TRUE)
ter_models <-   read.mulTree(mulTree.chain = "cff_supp_terr_models",
convergence = FALSE,
model = FALSE,
extract = NULL)
print(summary(ter_models)[,c(1,2,5)], digits = 2)
ddd <- data.frame(dd = c(1,2,3,,3), cc = c(1,,2,3,4) )
ddd <- data.frame(dd = c(1,2,3,NA,3), cc = c(1,NA,2,3,4) )
ddd
gg <- ddd[ddd$dd != NA]
gg <- ddd[ddd$dd != "NA",]
gg
ddd <- data.frame(dd = c(1,2,3,,3), cc = c(1,"",2,3,4) )
ddd <- data.frame(dd = c(1,2,3,"",3), cc = c(1,"",2,3,4) )
ddd
gg <- ddd[ddd$dd != "",]
gg
na.omit(ddd[ddd$dd != "",])
na.omit(ddd)
na.omit(ddd) /'?'
cars
wilcox.test()
wilcox.test
?wilcox.test
cff_raw <- read.csv("Haarlem_et_al_cff_dataset_21_10_2025.csv",
header = T,
sep = ",")
#Create a varaible for log10(CFF)
cff_raw$CFF_log <- log10(cff_raw$CFF)
#Set sessile_food as the baseline
cff_raw$mode_of_life <- factor(cff_raw$mode_of_life,
levels = c("sessile_food",
"ballistic",
"pursuit"
))
#Set terrestrial as the baseline
cff_raw$habitat <- factor(cff_raw$habitat,
levels = c("terrestrial",
"nektonic",
"demersal",
"volant"
))
cff_clean <- cff_raw[,c("Species_phylo",
"Class",
"habitat",
"forage_light_level",
"body_mass",
"mode_of_life",
"Method",
"CFF",
"CFF_log")]
#Drop Melanophila_acuminata
cff_clean <- cff_clean[cff_clean$Species_phylo != "Melanophila_acuminata",]
cff_clean <- data.frame(cff_clean, animal = cff_clean$Species_phylo)
#If you need to install any of these packages run this line
#install.packages("phytools","caper","MCMCglmm","hdrcde")
library(phytools)
library(caper)
library(MCMCglmm)
library(hdrcde)
#If you need to install mulTree run these lines
#if(!require(devtools)) install.packages("devtools")
#library(devtools)
#install_github("TGuillerme/mulTree", ref = "release")
library(mulTree)
cff_raw <- read.csv("Haarlem_et_al_cff_dataset_21_10_2025.csv",
header = T,
sep = ",")
#Create a varaible for log10(CFF)
cff_raw$CFF_log <- log10(cff_raw$CFF)
#Set sessile_food as the baseline
cff_raw$mode_of_life <- factor(cff_raw$mode_of_life,
levels = c("sessile_food",
"ballistic",
"pursuit"
))
#Set terrestrial as the baseline
cff_raw$habitat <- factor(cff_raw$habitat,
levels = c("terrestrial",
"nektonic",
"demersal",
"volant"
))
cff_clean <- cff_raw[,c("Species_phylo",
"Class",
"habitat",
"forage_light_level",
"body_mass",
"mode_of_life",
"Method",
"CFF",
"CFF_log")]
#Drop Melanophila_acuminata
cff_clean <- cff_clean[cff_clean$Species_phylo != "Melanophila_acuminata",]
cff_clean <- data.frame(cff_clean, animal = cff_clean$Species_phylo)
cff_tree <- read.tree("cff_tree_test2.tree")
plot(cff_tree[[1]],
type = "fan",
cex = 0.15)
cff_mul <- as.mulTree(cff_clean,
cff_tree,
taxa = "animal",
rand.terms = ~animal + Species_phylo,
clean.data = FALSE)
nitt <- 240000
thin <- 100
burnin <- 40000
parameters <- c(nitt,
thin,
burnin)
prior <-list(R = list(V = 1, nu=0.002),
G = list(G1=list(V = 1,n = 2,
nu=0.002),
G2=list(V = 1,n = 2,
nu=0.002)
))
Main_models <-   read.mulTree(mulTree.chain = "mulTree_supp_models",
convergence = FALSE,
model = FALSE)
Main_models_sp <-   read.mulTree(mulTree.chain = "mulTree_supp_models",
convergence = FALSE,
model = FALSE,
extract = c("VCV"))
print(summary(Main_models)[,c(1,2,5)],
digits = 2)
#phylo term
phylo_animal <- list()
for(i in 1:length(Main_models_sp)){
phylo_animal[[i]] <- Main_models_sp[[1]][,"animal"]
}
phylo_animal <- unlist(phylo_animal)
#species term
sp_rand <- list()
for(i in 1:length(Main_models_sp)){
sp_rand[[i]] <- Main_models_sp[[1]][,"Species_phylo"]
}
sp_rand <- unlist(sp_rand)
#resids term
resids_rand <- list()
for(i in 1:length(Main_models_sp)){
resids_rand[[i]] <- Main_models_sp[[1]][,"units"]
}
resids_rand <- unlist(resids_rand)
random_main_terms_summary <- data.frame(phylo_animal,
sp_rand,
resids_rand)
summary(random_main_terms_summary)
# Calculate H2
H_main <- phylo_animal/c(phylo_animal + sp_rand + resids_rand)
H_out <- list(mode = hdr(H_main)$mode,
CI_95 = hdr(H_main)$hdr[2,1:2])
H_out
hdr(H_main)$hdr
# Calculate H2
H_main <- phylo_animal/c(phylo_animal + sp_rand + resids_rand)
H_out <- list(mode = hdr(H_main)$mode,
CI_95 = hdr(H_main)$hdr[2,1:8])
H_out
# Calculate H2
H_main <- phylo_animal/c(phylo_animal + sp_rand + resids_rand)
H_out <- list(mode = hdr(H_main)$mode,
CI_95 = hdr(H_main)$hdr[2,c(1,8)])
H_out
